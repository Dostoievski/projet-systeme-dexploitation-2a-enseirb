#include <stdio.h>
#include <assert.h>
#include <ucontext.h>
#include "threadStructure.h"
#include "fifoThread.h"
#include "thread.h"


static void * function1(void *arg)
{
  char * number = arg;
  printf("i'm the thread %d, lancé avc l'argument %s\n",thread_self(),number);
  thread_yield();
  printf("je suis le thread %d, lancé avec l'argument %s\n",thread_self(),number);
  thread_exit(arg);
}
int main(void){
  thread_t th1,th2,th3,th4,th5,th6;
  void * retval1, *retval2,*retval3,*retval4,*retval5,*retval6;
  int err;

//lancer threads
  printf("le main lance les six threads... \n");
  err = thread_create(&th1,function1, "th1");
  assert(!err);
  err = thread_create(&th2,function1, "th2");
  assert(!err);
  err = thread_create(&th3,function1, "th3");
  assert(!err);
  err = thread_create(&th4,function1, "th4");
  assert(!err);
  err = thread_create(&th5,function1, "th5");
  assert(!err);
  err = thread_create(&th6,function1, "th6");
  assert(!err);

  printf("le main a lancé les threads %d and %d %d and %d and %d and %d\n",th1,th2,th3,th4,th5,th6);


  printf("le main attend les threads\n");
  err = thread_join(th1,&retval1);
  assert(!err);
  err = thread_join(th2,&retval2);
  assert(!err);
  err = thread_join(th3,&retval3);
  assert(!err);
  err = thread_join(th4,&retval4);
  assert(!err);
  err = thread_join(th5,&retval5);
  assert(!err);
  err = thread_join(th6,&retval6);
  assert(!err);

  printf("les threads ont terminé en renvoyant %s,%s,%s,%s,%s et %s\n",(char*)retval1,(char*)retval2,(char*)retval3,(char*)retval4,(char*)retval5,(char*)retval6);

  printf("thread self %d\n",thread_self());
  return 0;


}
