#include <stdio.h>
#include <assert.h>
#include <ucontext.h>
#include "thread.h"


static void * function(void *arg)
{
  int * number = arg;
  printf("je suis the thread %d, lancé avc l'argument %d\n",thread_self(),*number);
  thread_yield();
  printf("2 - i'm the thread %d, lancé avc l'argument %d\n",thread_self(),*number);
  thread_yield();
  printf("3 - i'm the thread %d, lancé avc l'argument %d\n",thread_self(),*number);
  thread_yield();
  thread_exit(arg);
}
int main(void){
  thread_t th1;
  void * retval1;
  int err;

//lancer un thread
  printf("le main lance le premier thread \n");
  err = thread_create(&th1,function, "totototo");
  assert(!err);
  printf("le main a lancé le premier thread\n");
//attendre sa terminaison
  printf("le main attend sa terminaison\n");
  err = thread_join(th1,&retval1);
  assert(!err);
//les ressources sont bien libérées

  printf("le premier thread a terminé en renvoyant la valeur %d\n",*((int*)retval1));

  printf("thread self %d\n",thread_self());
  return 0;


}
