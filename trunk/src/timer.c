#include <stdio.h>
#include <stdlib.h>

#ifdef O_PREEMPTION

#include <signal.h>
#include <sys/time.h>
#include "thread.h"

static long GRANULARITE = 1000;

void handler(){
  thread_yield();
}

void setGranularite(long time){
  GRANULARITE = time;
}

long getGranularite(){
  return GRANULARITE;
}

void setTimer(){
  struct itimerval value;
  value.it_interval.tv_sec = 0;
  value.it_interval.tv_usec = GRANULARITE;
  
  value.it_value.tv_sec = 0;
  value.it_value.tv_usec = 1;/*jamais mettre valeur nulle*/
  
  signal(SIGALRM,handler);
  
  setitimer(ITIMER_REAL,&value,NULL);
}
#endif

void timer(void(*func)(void*) , void *funcarg){
#ifdef O_PREEMPTION
  setTimer();  
#endif
  func(funcarg);
}
