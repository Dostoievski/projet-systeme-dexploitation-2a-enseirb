#include <pthread.h>
#include <stdio.h>
#include <assert.h>
#include <sys/time.h>
#include <unistd.h>
#include <ucontext.h>
#include "threadStructure.h"
#include "fifoThread.h"
#include "thread.h"

static void * pthreadfunc(void * arg)
{
  char *name = arg;
  printf("je suis le thread %p, lancé avec l'argument %s\n",
	 (void*) pthread_self(), name);
  
}

static void * threadfunc(void * arg)
{
  char *name = arg;
  printf("je suis le thread %p, lancé avec l'argument %s\n",
	 (void*) thread_self(), name);
  
}

double getTime(){
  struct timeval tv;
  gettimeofday(&tv,NULL);
  return 1000*tv.tv_sec+tv.tv_usec/1000.0;
}

int main(){
  double t0 = getTime();
  double t2=0.0,t3=0.0;

  //les deux threads 
  pthread_t pth;
  thread_t th;
  int err;

  printf("le main lance 2 threads...\n");

//on commence à t1 les deux threads
  double t1 = getTime();

//on voit que à t2, il y a creation par pthread_create
  err = pthread_create(&pth, NULL, pthreadfunc, "pth");
  assert(!err);
  t2 = getTime();
  printf("Le pth a été créé après %g\n",t2-t1);


  double t4 = getTime();
//on voit que à t3, il y a creation par thread_create
  err = thread_create(&th, threadfunc, "th");
  assert(!err);
  t3 = getTime();
  printf("Le th a été créé après %g\n", t3-t4);

  printf("le main a lancé les threads %p et %p\n",
	 (void *)pth, (void *)th);
}
