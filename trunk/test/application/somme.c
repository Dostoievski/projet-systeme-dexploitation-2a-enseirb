#include <pthread.h>
#include <stdio.h>
#include <stdlib.h>
#include <assert.h>
#include <sys/time.h>
#include "../../src/thread.h"

#define SIZE 100000

int TAB[SIZE] = {1};

static void* somme(int* a){
  int i;
  int s = 0;
  for(i = a; i < *a+20 ; i++){
    s += T[i];
    thread_yield();
  } 
  trhread_exit(s);
} 

int main(){
  int i;
  thread_t* tid[SIZE/20];
  int* retVal[SIZE/20];
  int err, resultat = 0;
  for(i = 0; i<SIZE/20 ; i++){
    int a = i*20;
    err = thread_create(tid[i], somme, &a);
    assert(!err);
  }

  for(i = 0; i<SIZE/20 ; i++){
    err = thread_join(*(tid[i]), &(retVal[i]));
    assert(!err);
    resultat += *(retVal[i]);
  }
  printf("Tableau de taille %d\n", SIZE);
  printf("      somme des elements = %d\n",resultat);
  return EXIT_SUCCESS;
}
