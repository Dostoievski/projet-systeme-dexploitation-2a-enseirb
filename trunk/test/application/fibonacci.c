#include<stdlib.h>
#include<stdio.h>
#include <unistd.h>
#include "../../src/thread.h"

#define INCONNUE -1
#define TAILLE_FIBOTAB_MAX 1000000

static int fibotab[TAILLE_FIBOTAB_MAX];

int fibo(int n){
  if(n<2)
    return fibotab[n];
  else
    return fibo(n-1)+ fibo(n-2);
}

void init_fibo_tab(int n){
  int i;
  fibotab[0]=0;
  fibotab[1]=1;
  for(i=0; i<n; i++){
    fibotab[i] = INCONNUE;
  }
}

int get_fifo_tab_size(){
  printf("Entrez la taille de votre tableau \n");
  int n;
  scanf("%d",&n);
  printf("la taille que vous avez saisis est n = %d\n",n);
  return n;
}

int main(void){
  /*demander la taille de la suite*/
  int n = get_fifo_tab_size();

  /*initialiser le tableau de suite a -1 */
  init_fibo_tab(n);

  /*lancer les thread pour calculer les fibo*/
  thread_t tab[n];
  int j;
  for(j = 0; j<=n; j++)
    {
      thread_create(&tab[j], (void *(*)(void *)) &fibo, (void *)j);
      if(j>0)
	{
	  fprintf(stderr, "J'attend le thread %d\n",j);
	  thread_join(tab[j-1], NULL);
	}
    }
  
  /* On affiche le résultat */
  for(j=0;j<=n;j++)
    printf("Résultat : fibo(%d)=%d \n",j, fibotab[j]);
  
  return EXIT_SUCCESS; 

}
