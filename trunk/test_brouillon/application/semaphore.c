#include <pthread.h>
#include <stdio.h>
#include <stdlib.h>
#include <assert.h>
#include <sys/time.h>
#include "../../src/thread.h"

#include <stdio.h> 
#include <stdlib.h> 
#include <pthread.h> 
#include <semaphore.h> 
#include <unistd.h> 


sem_t mutex;


void* affichage (void* name)
{
    int i, j;
    for(i = 0; i < 20; i++) {
        sem_wait(&mutex); /* prologue */
        for(j=0; j<5; j++) printf("%s ",(char*)name);
        thread_yield(); /* pour etre sur d'avoir des problemes */
        for(j=0; j<5; j++) printf("%s ",(char*)name);
        printf("\n ");
        sem_post(&mutex); /* epilogue */
    }
    return NULL;
} 


int main (void)
{ 
    thread_t filsA, filsB;
    void*a = "a";
    void*b = "b";
    
    sem_init(&mutex, 0, 1);

    if (thread_create(&filsA, affichage,(void*)&a)) { 
        perror("thread_create"); 
        exit(EXIT_FAILURE); 
    } 
    if (thread_create(&filsB, affichage, (void*)&b)) { 
        perror("thread_create"); 
        exit(EXIT_FAILURE); 
    } 

    if (thread_join(filsA, NULL)) 
        perror("pthread_join"); 

    if (thread_join(filsB, NULL)) 
        perror("pthread_join"); 

    printf("Fin du pere\n") ;
    return (EXIT_SUCCESS);
}
