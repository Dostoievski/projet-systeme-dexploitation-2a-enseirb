#include <ucontext.h>
#include <stdlib.h>
#include <stdio.h>
#include <assert.h>
#include "fifoThread.h"

/*
 * create the fifo thread
*/

fifoThread * createFifoThread(){
  fifoThread* f = (fifoThread *)malloc(sizeof(fifoThread));
  if(f){
    f->head = NULL;
    f->tail = NULL;
    return f;
  }
  return NULL;
}

/*
 * init a fifo thread
 */

void initFifoThread(fifoThread * fifo){
  assert(fifo);
  thread *th = fifo->head;
  while(th){
    tread * tmp = th;
    th = th->next;
    killThread(tmp);
  }
}

/*
 * kill a fifo thread
 */

void killFifoThread(fifoThread * fifo){
  initFifoThread(fifo);
  free(fifo);
}

/*
 * add an element to the fifo thread
 */

int enqueueFifoThread(fifoThread *fifo, thread *th){
  assert(fifo);
  
  if(th->next)
    return 0;
  
  if(fifo->tail){
    fifo->tail->next = th;
    fifo->tail = th;
    th->next = NULL;
    return 1;
  }
  fifo->head = th;
  fifo->tail = th;
  th->next = NULL;
  return 1;
}

/*
 * return the thread which is at the head of fifo thread
 */

struct thread* getHeadFifoThread (fifoThread* fifo){
  return fifo->head;
}

/*
 * return the thread which is at the end of fifo thread
 */

struct thread* getTailFifoThread (fifoThread* fifo){
  return fifo->tail;
}

